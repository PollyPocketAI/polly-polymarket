<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ü¶â Polly ‚Äî Polymarket Agent</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:       #0b0d12;
      --surface:  #13161f;
      --card:     #181c27;
      --border:   #252a3a;
      --border2:  #2e3448;
      --accent:   #5b8ef7;
      --accent2:  #7ba3ff;
      --green:    #22c55e;
      --red:      #ef4444;
      --yellow:   #f59e0b;
      --purple:   #a78bfa;
      --text:     #e2e8f0;
      --muted:    #64748b;
      --muted2:   #4a5568;
      --fw:       250px;
    }

    body { background: var(--bg); color: var(--text); font-family: 'Inter', system-ui, sans-serif; height: 100vh; display: flex; overflow: hidden; }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    nav {
      width: var(--fw); min-width: var(--fw); background: var(--surface);
      border-right: 1px solid var(--border); display: flex; flex-direction: column;
      padding: 20px 0; overflow-y: auto;
    }
    .nav-logo { padding: 0 20px 24px; display: flex; align-items: center; gap: 10px; }
    .nav-logo span:first-child { font-size: 1.6rem; }
    .nav-logo-text h1 { font-size: 1.1rem; font-weight: 800; letter-spacing: -0.02em; }
    .nav-logo-text p { font-size: 0.72rem; color: var(--muted); }
    .nav-sep { height: 1px; background: var(--border); margin: 8px 16px; }
    .nav-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted2); padding: 12px 20px 4px; }
    .nav-item {
      display: flex; align-items: center; gap: 10px; padding: 9px 20px;
      cursor: pointer; font-size: 0.87rem; color: var(--muted); transition: all 0.15s;
      border-left: 3px solid transparent; margin: 1px 0;
    }
    .nav-item:hover { color: var(--text); background: rgba(255,255,255,0.04); }
    .nav-item.active { color: var(--accent2); background: rgba(91,142,247,0.1); border-left-color: var(--accent); }
    .nav-item .icon { font-size: 1rem; width: 20px; text-align: center; }
    .nav-badge { margin-left: auto; background: var(--accent); color: white; font-size: 0.65rem; padding: 1px 6px; border-radius: 10px; font-weight: 700; }
    .nav-status { margin-top: auto; padding: 16px 20px; border-top: 1px solid var(--border); }
    .status-dot { display: inline-block; width: 7px; height: 7px; border-radius: 50%; background: var(--green); box-shadow: 0 0 6px var(--green); margin-right: 6px; }
    .status-text { font-size: 0.78rem; color: var(--muted); }

    /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
    main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .topbar {
      background: var(--surface); border-bottom: 1px solid var(--border);
      padding: 14px 28px; display: flex; align-items: center; gap: 16px;
      flex-shrink: 0;
    }
    .topbar h2 { font-size: 1rem; font-weight: 700; }
    .topbar-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }
    .refresh-btn { background: var(--border); border: none; color: var(--text); padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 0.82rem; }
    .refresh-btn:hover { background: var(--border2); }
    .last-updated { font-size: 0.75rem; color: var(--muted); }

    .content { flex: 1; overflow-y: auto; padding: 24px 28px; }

    /* ‚îÄ‚îÄ Pages ‚îÄ‚îÄ */
    .page { display: none; }
    .page.active { display: block; }

    /* ‚îÄ‚îÄ Stat Cards ‚îÄ‚îÄ */
    .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; margin-bottom: 24px; }
    .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 18px; }
    .stat-label { font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.06em; color: var(--muted); margin-bottom: 8px; }
    .stat-value { font-size: 1.6rem; font-weight: 800; line-height: 1; }
    .stat-sub { font-size: 0.75rem; color: var(--muted); margin-top: 5px; }
    .stat-value.green { color: var(--green); }
    .stat-value.red { color: var(--red); }
    .stat-value.accent { color: var(--accent2); }
    .stat-value.yellow { color: var(--yellow); }

    /* ‚îÄ‚îÄ Section headers ‚îÄ‚îÄ */
    .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
    .section-title { font-size: 0.9rem; font-weight: 700; }
    .section-sub { font-size: 0.78rem; color: var(--muted); }

    /* ‚îÄ‚îÄ Tables ‚îÄ‚îÄ */
    .table-wrap { background: var(--card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; margin-bottom: 24px; }
    table { width: 100%; border-collapse: collapse; }
    th { text-align: left; padding: 10px 14px; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); border-bottom: 1px solid var(--border); background: var(--surface); cursor: pointer; white-space: nowrap; }
    th:hover { color: var(--text); }
    td { padding: 9px 14px; border-bottom: 1px solid var(--border); font-size: 0.85rem; vertical-align: middle; }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: rgba(255,255,255,0.02); }

    /* ‚îÄ‚îÄ Price bars ‚îÄ‚îÄ */
    .price-pill { padding: 2px 8px; border-radius: 5px; font-size: 0.78rem; font-weight: 700; }
    .pill-high   { background: rgba(34,197,94,0.15);  color: var(--green); }
    .pill-mid    { background: rgba(245,158,11,0.15); color: var(--yellow); }
    .pill-low    { background: rgba(239,68,68,0.15);  color: var(--red); }
    .pill-accent { background: rgba(91,142,247,0.15); color: var(--accent2); }
    .pill-pass   { background: rgba(100,116,139,0.12); color: var(--muted); }

    .prob-bar { display: flex; align-items: center; gap: 8px; }
    .bar-track { height: 4px; width: 70px; background: var(--border); border-radius: 2px; overflow: hidden; flex-shrink: 0; }
    .bar-fill { height: 100%; border-radius: 2px; }

    /* ‚îÄ‚îÄ Search / filter ‚îÄ‚îÄ */
    .filter-row { display: flex; gap: 10px; margin-bottom: 14px; align-items: center; }
    .search-box { flex: 1; background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); padding: 8px 12px; font-size: 0.87rem; outline: none; }
    .search-box:focus { border-color: var(--accent); }
    .filter-select { background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); padding: 8px 12px; font-size: 0.85rem; outline: none; cursor: pointer; }

    /* ‚îÄ‚îÄ Cards grid ‚îÄ‚îÄ */
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 14px; }
    .research-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; cursor: pointer; transition: border-color 0.15s; }
    .research-card:hover { border-color: var(--accent); }
    .rc-header { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; }
    .rc-question { font-size: 0.87rem; line-height: 1.4; flex: 1; }
    .rc-meta { display: flex; gap: 14px; font-size: 0.78rem; color: var(--muted); }
    .rc-meta span { display: flex; flex-direction: column; gap: 2px; }
    .rc-meta strong { font-size: 0.88rem; color: var(--text); }

    /* ‚îÄ‚îÄ Wallet cards ‚îÄ‚îÄ */
    .wallet-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .wallet-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
    .wc-label { font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.06em; color: var(--muted); margin-bottom: 4px; }
    .wc-address { font-family: monospace; font-size: 0.78rem; color: var(--muted); margin-bottom: 16px; word-break: break-all; }
    .wc-balances { display: flex; gap: 20px; }
    .wc-bal { display: flex; flex-direction: column; gap: 3px; }
    .wc-bal-amount { font-size: 1.4rem; font-weight: 800; }
    .wc-bal-label { font-size: 0.72rem; color: var(--muted); }
    .wc-status { display: inline-flex; align-items: center; gap: 5px; margin-top: 12px; font-size: 0.75rem; }

    /* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 200; align-items: center; justify-content: center; padding: 24px; }
    .modal-overlay.open { display: flex; }
    .modal { background: var(--card); border: 1px solid var(--border2); border-radius: 14px; max-width: 760px; width: 100%; max-height: 84vh; display: flex; flex-direction: column; }
    .modal-header { padding: 18px 22px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
    .modal-header h3 { font-size: 0.95rem; font-weight: 700; }
    .modal-close { background: none; border: none; color: var(--muted); font-size: 1.1rem; cursor: pointer; padding: 4px; }
    .modal-close:hover { color: var(--text); }
    .modal-body { padding: 20px 22px; overflow-y: auto; flex: 1; }
    .modal-body pre { white-space: pre-wrap; font-family: inherit; font-size: 0.84rem; line-height: 1.65; color: var(--text); }

    /* ‚îÄ‚îÄ Info boxes ‚îÄ‚îÄ */
    .info-box { background: rgba(91,142,247,0.08); border: 1px solid rgba(91,142,247,0.2); border-radius: 8px; padding: 12px 16px; font-size: 0.83rem; color: var(--accent2); margin-bottom: 16px; }
    .warn-box  { background: rgba(245,158,11,0.08); border: 1px solid rgba(245,158,11,0.2); border-radius: 8px; padding: 12px 16px; font-size: 0.83rem; color: var(--yellow); margin-bottom: 16px; }

    /* ‚îÄ‚îÄ Loading / empty ‚îÄ‚îÄ */
    .loading-box { text-align: center; padding: 60px; color: var(--muted); font-size: 0.88rem; }
    .spinner { display: inline-block; width: 18px; height: 18px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 8px; vertical-align: middle; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Activity feed ‚îÄ‚îÄ */
    .feed { display: flex; flex-direction: column; gap: 0; }
    .feed-item { display: flex; gap: 14px; padding: 12px 0; border-bottom: 1px solid var(--border); }
    .feed-item:last-child { border-bottom: none; }
    .feed-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; margin-top: 2px; }
    .fi-scan   { background: rgba(167,139,250,0.12); }
    .fi-bet    { background: rgba(34,197,94,0.12); }
    .fi-loss   { background: rgba(239,68,68,0.12); }
    .fi-info   { background: rgba(91,142,247,0.12); }
    .feed-content h4 { font-size: 0.85rem; font-weight: 600; margin-bottom: 2px; }
    .feed-content p  { font-size: 0.78rem; color: var(--muted); line-height: 1.4; }
    .feed-time { margin-left: auto; font-size: 0.72rem; color: var(--muted2); white-space: nowrap; padding-top: 4px; }

    /* ‚îÄ‚îÄ Two-col ‚îÄ‚îÄ */
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    @media (max-width: 900px) { .two-col { grid-template-columns: 1fr; } }

    .panel { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 18px; margin-bottom: 20px; }
    .panel h3 { font-size: 0.88rem; font-weight: 700; margin-bottom: 14px; color: var(--accent2); }

    /* ‚îÄ‚îÄ Chip tag ‚îÄ‚îÄ */
    .chip { display: inline-block; padding: 1px 7px; border-radius: 4px; font-size: 0.7rem; background: var(--border); color: var(--muted); margin: 1px; }
  </style>
</head>
<body>

<!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<nav>
  <div class="nav-logo">
    <span>ü¶â</span>
    <div class="nav-logo-text">
      <h1>Polly</h1>
      <p>Polymarket Agent</p>
    </div>
  </div>

  <div class="nav-sep"></div>
  <div class="nav-label">Main</div>
  <div class="nav-item active" data-page="overview">
    <span class="icon">üè†</span> Overview
  </div>
  <div class="nav-item" data-page="markets">
    <span class="icon">üìä</span> Live Markets
  </div>
  <div class="nav-item" data-page="research">
    <span class="icon">üî¨</span> Research
    <span class="nav-badge" id="researchBadge">0</span>
  </div>

  <div class="nav-sep"></div>
  <div class="nav-label">Trading</div>
  <div class="nav-item" data-page="portfolio">
    <span class="icon">üíº</span> Portfolio
  </div>
  <div class="nav-item" data-page="history">
    <span class="icon">üìã</span> Trade History
  </div>

  <div class="nav-sep"></div>
  <div class="nav-label">Funds</div>
  <div class="nav-item" data-page="wallets">
    <span class="icon">üí∞</span> Wallets
  </div>

  <div class="nav-status">
    <div><span class="status-dot" id="statusDot"></span><span class="status-text" id="statusText">Connecting‚Ä¶</span></div>
    <div style="font-size:0.7rem;color:var(--muted2);margin-top:4px" id="uptimeText"></div>
  </div>
</nav>

<!-- ‚îÄ‚îÄ Main ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<main>
  <div class="topbar">
    <h2 id="pageTitle">Overview</h2>
    <div class="topbar-right">
      <span class="last-updated" id="lastUpdated">‚Äî</span>
      <button class="refresh-btn" onclick="refreshAll()">‚Üª Refresh</button>
    </div>
  </div>

  <div class="content">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OVERVIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page active" id="page-overview">
      <div class="stats-row" id="overviewStats">
        <div class="stat-card"><div class="stat-label">Total USDC</div><div class="stat-value accent" id="ov-usdc">‚Äî</div><div class="stat-sub">across both wallets</div></div>
        <div class="stat-card"><div class="stat-label">Trading Wallet</div><div class="stat-value" id="ov-poly-usdc">‚Äî</div><div class="stat-sub">Polymarket balance</div></div>
        <div class="stat-card"><div class="stat-label">P&amp;L (all time)</div><div class="stat-value" id="ov-pnl">‚Äî</div><div class="stat-sub" id="ov-roi">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">Success Rate</div><div class="stat-value" id="ov-winrate">‚Äî</div><div class="stat-sub" id="ov-trades">0 settled bets</div></div>
        <div class="stat-card"><div class="stat-label">Open Orders</div><div class="stat-value accent" id="ov-orders">‚Äî</div><div class="stat-sub">on Polymarket</div></div>
        <div class="stat-card"><div class="stat-label">Scans Run</div><div class="stat-value yellow" id="ov-scans">‚Äî</div><div class="stat-sub">research sessions</div></div>
      </div>

      <div class="two-col">
        <div>
          <div class="section-header"><span class="section-title">Recent Activity</span><span class="section-sub">What Polly's been up to</span></div>
          <div class="panel">
            <div class="feed" id="activityFeed">
              <div class="loading-box"><span class="spinner"></span>Loading‚Ä¶</div>
            </div>
          </div>
        </div>
        <div>
          <div class="section-header"><span class="section-title">Top Markets Right Now</span><span class="section-sub">by 24h volume</span></div>
          <div class="panel">
            <div id="topMarketsList"><div class="loading-box"><span class="spinner"></span>Loading‚Ä¶</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MARKETS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-markets">
      <div class="filter-row">
        <input class="search-box" id="mktSearch" placeholder="Search markets‚Ä¶" oninput="renderMarkets()"/>
        <select class="filter-select" id="mktSort" onchange="renderMarkets()">
          <option value="volume24h">Sort: 24h Volume</option>
          <option value="volume">Sort: Total Volume</option>
          <option value="yesPrice">Sort: YES Price</option>
          <option value="liquidity">Sort: Liquidity</option>
          <option value="endDate">Sort: End Date</option>
        </select>
        <select class="filter-select" id="mktFilter" onchange="renderMarkets()">
          <option value="all">All markets</option>
          <option value="low">Long shots (YES &lt; 10%)</option>
          <option value="mid">Contested (10‚Äì70%)</option>
          <option value="high">Likely YES (&gt; 70%)</option>
        </select>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Market</th>
              <th onclick="setSortKey('yesPrice')">YES%</th>
              <th onclick="setSortKey('volume24h')">24h Vol</th>
              <th onclick="setSortKey('volume')">Total Vol</th>
              <th onclick="setSortKey('liquidity')">Liquidity</th>
              <th onclick="setSortKey('endDate')">Ends</th>
            </tr>
          </thead>
          <tbody id="marketsBody">
            <tr><td colspan="6" class="loading-box"><span class="spinner"></span>Loading markets‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESEARCH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-research">
      <div class="info-box">üî¨ Every market Polly evaluates is logged here with full reasoning, confidence scores, and the bet/pass verdict.</div>
      <div class="filter-row">
        <input class="search-box" id="resSearch" placeholder="Search research logs‚Ä¶" oninput="renderResearch()"/>
        <select class="filter-select" id="resFilter" onchange="renderResearch()">
          <option value="all">All verdicts</option>
          <option value="BET">Bets only</option>
          <option value="PASS">Passes only</option>
          <option value="SCAN">Scan summaries</option>
        </select>
      </div>
      <div class="cards-grid" id="researchGrid">
        <div class="loading-box"><span class="spinner"></span>Loading research‚Ä¶</div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PORTFOLIO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-portfolio">
      <div class="stats-row">
        <div class="stat-card"><div class="stat-label">Open Orders</div><div class="stat-value accent" id="port-orders">‚Äî</div><div class="stat-sub">awaiting fill</div></div>
        <div class="stat-card"><div class="stat-label">Total Bet (all time)</div><div class="stat-value" id="port-totalbet">‚Äî</div><div class="stat-sub">USDC deployed</div></div>
        <div class="stat-card"><div class="stat-label">Realized P&amp;L</div><div class="stat-value" id="port-pnl">‚Äî</div><div class="stat-sub" id="port-roi">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">Win Rate</div><div class="stat-value" id="port-wr">‚Äî</div><div class="stat-sub" id="port-wl">‚Äî</div></div>
      </div>

      <div class="section-header"><span class="section-title">Open Orders</span></div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Market</th><th>Side</th><th>Price</th><th>Size</th><th>Status</th><th>Created</th></tr></thead>
          <tbody id="ordersBody"><tr><td colspan="6" class="loading-box"><span class="spinner"></span>Loading‚Ä¶</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-history">
      <div class="section-header"><span class="section-title">Trade History</span><span class="section-sub">All executed trades</span></div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Time</th><th>Market</th><th>Side</th><th>Price</th><th>Size</th><th>Status</th><th>P&amp;L</th></tr></thead>
          <tbody id="historyBody"><tr><td colspan="7" class="loading-box"><span class="spinner"></span>Loading‚Ä¶</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WALLETS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-wallets">
      <div class="warn-box">‚ö†Ô∏è Polly's trading wallet needs USDC.e on Polygon to place bets. Deposit directly to the Polymarket wallet address below.</div>

      <div class="wallet-grid" id="walletGrid">
        <div class="loading-box"><span class="spinner"></span>Fetching balances‚Ä¶</div>
      </div>

      <div class="two-col">
        <div class="panel">
          <h3>üì• How to Fund Trading</h3>
          <div style="font-size:0.84rem;line-height:1.8;color:var(--muted)">
            <b style="color:var(--text)">To start trading:</b><br>
            1. Send <b style="color:var(--accent2)">USDC.e</b> on <b style="color:var(--green)">Polygon</b> to the Polymarket wallet address<br>
            2. Polly will detect the balance and start placing bets when edge is found<br>
            3. Profits accumulate in the Polymarket wallet<br><br>
            <b style="color:var(--text)">Cold storage:</b><br>
            Cosmi sends long-term funds to the Holding wallet.<br>
            Polly will never move funds from Holding ‚Üí Polymarket without instruction.
          </div>
        </div>
        <div class="panel">
          <h3>üîê Wallet Security</h3>
          <div style="font-size:0.84rem;line-height:1.8;color:var(--muted)">
            <b style="color:var(--text)">Holding wallet:</b> Cold storage. Private key loaded but funds stay here unless instructed.<br><br>
            <b style="color:var(--text)">Polymarket wallet:</b> Hot wallet for trading. Only USDC actively needed for bets goes here.<br><br>
            <b style="color:var(--text)">Private keys:</b> Stored in <code style="color:var(--accent2)">.env</code> on server only. Never logged, never committed to git.
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- ‚îÄ‚îÄ Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="modal-overlay" id="modalOverlay" onclick="maybeCloseModal(event)">
  <div class="modal">
    <div class="modal-header">
      <h3 id="modalTitle">Details</h3>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
'use strict';

// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let markets    = [];
let research   = [];
let balances   = {};
let pnl        = {};
let orders     = [];
let trades     = [];
let mktSortDir = -1;
let mktSortKey = 'volume24h';

// ‚îÄ‚îÄ Nav ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const pageTitles = {
  overview: 'Overview', markets: 'Live Markets', research: 'Research Logs',
  portfolio: 'Portfolio', history: 'Trade History', wallets: 'Wallets & Balances'
};

document.querySelectorAll('.nav-item').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
    el.classList.add('active');
    const p = el.dataset.page;
    document.getElementById(`page-${p}`).classList.add('active');
    document.getElementById('pageTitle').textContent = pageTitles[p] || p;
    loadPage(p);
  });
});

function loadPage(p) {
  if (p === 'markets')   renderMarkets();
  if (p === 'research')  renderResearch();
  if (p === 'portfolio') loadPortfolio();
  if (p === 'history')   loadHistory();
  if (p === 'wallets')   loadWallets();
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fmt  = n => n >= 1e6 ? `$${(n/1e6).toFixed(1)}M` : n >= 1e3 ? `$${(n/1e3).toFixed(0)}K` : `$${(n||0).toFixed(2)}`;
const fmtP = n => `${(n*100).toFixed(1)}%`;
const fmtD = s => s ? s.slice(0,10) : '‚Äî';
const ts   = () => new Date().toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit'});

function pillClass(p) {
  if (p >= 0.7) return 'pill-high';
  if (p >= 0.4) return 'pill-mid';
  return 'pill-low';
}
function barColor(p) {
  if (p >= 0.7) return 'var(--green)';
  if (p >= 0.4) return 'var(--yellow)';
  return 'var(--red)';
}

// ‚îÄ‚îÄ Status ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadStatus() {
  try {
    const d = await fetch('/api/status').then(r => r.json());
    document.getElementById('statusText').textContent = d.ok ? 'Agent Online' : 'Error';
    document.getElementById('statusDot').style.background = d.ok ? 'var(--green)' : 'var(--red)';
    if (d.uptime) {
      const u = d.uptime;
      const h = Math.floor(u/3600), m = Math.floor((u%3600)/60);
      document.getElementById('uptimeText').textContent = `Up ${h}h ${m}m`;
    }
  } catch {
    document.getElementById('statusText').textContent = 'Offline';
    document.getElementById('statusDot').style.background = 'var(--red)';
  }
}

// ‚îÄ‚îÄ Overview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadOverview() {
  // Balances
  try {
    const b = await fetch('/api/balances').then(r => r.json());
    balances = b;
    document.getElementById('ov-usdc').textContent = b.totalUsdc != null ? `$${b.totalUsdc.toFixed(2)}` : '‚Äî';
    document.getElementById('ov-poly-usdc').textContent = b.polymarket?.usdc != null ? `$${b.polymarket.usdc.toFixed(2)}` : '‚Äî';
  } catch {}

  // P&L
  try {
    const p = await fetch('/api/pnl').then(r => r.json());
    pnl = p;
    const pv = p.totalPnl || 0;
    document.getElementById('ov-pnl').textContent = (pv >= 0 ? '+$' : '-$') + Math.abs(pv).toFixed(2);
    document.getElementById('ov-pnl').className = 'stat-value ' + (pv >= 0 ? 'green' : 'red');
    document.getElementById('ov-roi').textContent = `ROI: ${p.roi >= 0 ? '+' : ''}${p.roi}%`;
    document.getElementById('ov-winrate').textContent = p.successRate ? `${p.successRate}%` : '‚Äî';
    document.getElementById('ov-winrate').className = 'stat-value ' + (p.successRate >= 55 ? 'green' : p.successRate > 0 ? 'yellow' : '');
    document.getElementById('ov-trades').textContent = `${p.settled} settled bets`;
  } catch {}

  // Orders
  try {
    const o = await fetch('/api/orders').then(r => r.json());
    orders = o.orders || [];
    document.getElementById('ov-orders').textContent = orders.length;
    document.getElementById('port-orders').textContent = orders.length;
  } catch {}

  // Research count
  try {
    const r = await fetch('/api/decisions').then(r => r.json());
    research = r.decisions || [];
    document.getElementById('researchBadge').textContent = research.length;
    document.getElementById('ov-scans').textContent = research.length;
  } catch {}

  // Activity feed
  buildActivityFeed();

  // Top markets
  if (markets.length) buildTopMarkets();
  else {
    const m = await fetch('/api/markets?limit=50').then(r => r.json());
    markets = m.markets || [];
    buildTopMarkets();
  }

  document.getElementById('lastUpdated').textContent = `Updated ${ts()}`;
}

function buildActivityFeed() {
  const feed = document.getElementById('activityFeed');
  const items = [];

  // From research logs
  research.slice(0, 8).forEach(r => {
    const isBet  = r.verdict?.includes('BET');
    const isScan = r.verdict === 'SCAN';
    items.push({
      icon:  isBet ? 'üí∞' : isScan ? 'üî¨' : 'üìã',
      cls:   isBet ? 'fi-bet' : isScan ? 'fi-scan' : 'fi-info',
      title: r.verdict === 'SCAN' ? 'Market Scan' : `Research: ${r.verdict}`,
      desc:  r.question?.slice(0, 80) || r.file,
      time:  r.file?.slice(0,10) || '',
    });
  });

  if (!items.length) {
    feed.innerHTML = '<div style="color:var(--muted);font-size:0.83rem;text-align:center;padding:20px">No activity yet. Polly is warming up.</div>';
    return;
  }

  feed.innerHTML = items.map(i => `
    <div class="feed-item">
      <div class="feed-icon ${i.cls}">${i.icon}</div>
      <div class="feed-content">
        <h4>${i.title}</h4>
        <p>${i.desc}</p>
      </div>
      <div class="feed-time">${i.time}</div>
    </div>`).join('');
}

function buildTopMarkets() {
  const el = document.getElementById('topMarketsList');
  const top = [...markets].sort((a,b) => b.volume24h - a.volume24h).slice(0, 8);
  el.innerHTML = top.map(m => `
    <div style="display:flex;align-items:center;gap:10px;padding:7px 0;border-bottom:1px solid var(--border)">
      <span class="price-pill ${pillClass(m.yesPrice)}">${(m.yesPrice*100).toFixed(0)}%</span>
      <span style="font-size:0.83rem;flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis">${m.question}</span>
      <span style="font-size:0.78rem;color:var(--muted);flex-shrink:0">${fmt(m.volume24h)}</span>
    </div>`).join('') || '<div style="color:var(--muted);font-size:0.83rem">No markets loaded.</div>';
}

// ‚îÄ‚îÄ Markets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadMarkets() {
  if (markets.length) return;
  try {
    const d = await fetch('/api/markets?limit=100').then(r => r.json());
    markets = d.markets || [];
  } catch {}
}

function setSortKey(k) {
  if (mktSortKey === k) mktSortDir *= -1;
  else { mktSortKey = k; mktSortDir = -1; }
  renderMarkets();
}

function renderMarkets() {
  const q    = (document.getElementById('mktSearch')?.value || '').toLowerCase();
  const sort = document.getElementById('mktSort')?.value || 'volume24h';
  const filt = document.getElementById('mktFilter')?.value || 'all';

  let ms = [...markets];
  if (q) ms = ms.filter(m => m.question.toLowerCase().includes(q) || (m.tags||[]).join(' ').toLowerCase().includes(q));
  if (filt === 'low')  ms = ms.filter(m => m.yesPrice < 0.10);
  if (filt === 'mid')  ms = ms.filter(m => m.yesPrice >= 0.10 && m.yesPrice <= 0.70);
  if (filt === 'high') ms = ms.filter(m => m.yesPrice > 0.70);
  ms.sort((a,b) => mktSortDir * (String(a[sort] || '') < String(b[sort] || '') ? -1 : 1));

  const body = document.getElementById('marketsBody');
  if (!ms.length) { body.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:30px;color:var(--muted)">No markets match.</td></tr>'; return; }

  body.innerHTML = ms.map(m => `
    <tr>
      <td style="max-width:380px">
        <div style="font-size:0.85rem;line-height:1.4;margin-bottom:3px">${m.question}</div>
        <div>${(m.tags||[]).slice(0,3).map(t => `<span class="chip">${t}</span>`).join('')}</div>
      </td>
      <td>
        <div class="prob-bar">
          <span class="price-pill ${pillClass(m.yesPrice)}">${(m.yesPrice*100).toFixed(0)}%</span>
          <div class="bar-track"><div class="bar-fill" style="width:${m.yesPrice*100}%;background:${barColor(m.yesPrice)}"></div></div>
        </div>
      </td>
      <td style="color:var(--muted)">${fmt(m.volume24h)}</td>
      <td style="color:var(--muted)">${fmt(m.volume)}</td>
      <td style="color:var(--muted)">${fmt(m.liquidity)}</td>
      <td style="color:var(--muted2);font-size:0.8rem">${fmtD(m.endDate)}</td>
    </tr>`).join('');
}

// ‚îÄ‚îÄ Research ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderResearch() {
  const q    = (document.getElementById('resSearch')?.value || '').toLowerCase();
  const filt = document.getElementById('resFilter')?.value || 'all';

  let rs = [...research];
  if (q) rs = rs.filter(r => (r.question||'').toLowerCase().includes(q) || (r.file||'').toLowerCase().includes(q));
  if (filt === 'BET')  rs = rs.filter(r => r.verdict?.includes('BET'));
  if (filt === 'PASS') rs = rs.filter(r => r.verdict === 'PASS');
  if (filt === 'SCAN') rs = rs.filter(r => r.verdict === 'SCAN');

  const grid = document.getElementById('researchGrid');
  if (!rs.length) { grid.innerHTML = '<div class="loading-box">No research logs match.</div>'; return; }

  grid.innerHTML = rs.map(r => {
    const isBet  = r.verdict?.includes('BET');
    const isScan = r.verdict === 'SCAN';
    const pillCls = isBet ? 'pill-high' : isScan ? 'pill-accent' : 'pill-pass';
    return `
      <div class="research-card" onclick="openDecision('${r.file}')">
        <div class="rc-header">
          <span class="price-pill ${pillCls}">${r.verdict || 'SCAN'}</span>
        </div>
        <div class="rc-question">${r.question || r.file}</div>
        ${!isScan ? `
        <div class="rc-meta" style="margin-top:10px">
          <span><div style="color:var(--muted);font-size:0.7rem">Market</div><strong>${r.yesPrice ? (r.yesPrice*100).toFixed(0)+'%' : '‚Äî'}</strong></span>
          <span><div style="color:var(--muted);font-size:0.7rem">Polly</div><strong>${r.pollyP ? (r.pollyP*100).toFixed(0)+'%' : '‚Äî'}</strong></span>
          <span><div style="color:var(--muted);font-size:0.7rem">Edge</div><strong style="color:${r.edge>0?'var(--green)':r.edge<0?'var(--red)':'var(--muted)'}">${r.edge ? (r.edge>0?'+':'')+r.edge.toFixed(3) : '‚Äî'}</strong></span>
          <span><div style="color:var(--muted);font-size:0.7rem">Conf</div><strong>${r.conf ? (r.conf*100).toFixed(0)+'%' : '‚Äî'}</strong></span>
        </div>` : ''}
        <div style="margin-top:8px;font-size:0.72rem;color:var(--muted2)">${r.file?.slice(0,10)}</div>
      </div>`;
  }).join('');
}

async function openDecision(file) {
  document.getElementById('modalTitle').textContent = file.replace('.md','');
  document.getElementById('modalBody').innerHTML = '<div class="loading-box"><span class="spinner"></span>Loading‚Ä¶</div>';
  document.getElementById('modalOverlay').classList.add('open');
  try {
    const d = await fetch(`/api/decisions/${file}`).then(r => r.json());
    document.getElementById('modalBody').innerHTML = `<pre>${d.content}</pre>`;
  } catch (e) {
    document.getElementById('modalBody').innerHTML = `<p style="color:var(--red)">Error: ${e.message}</p>`;
  }
}

function closeModal() { document.getElementById('modalOverlay').classList.remove('open'); }
function maybeCloseModal(e) { if (e.target === document.getElementById('modalOverlay')) closeModal(); }

// ‚îÄ‚îÄ Portfolio ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadPortfolio() {
  // P&L
  try {
    const p = await fetch('/api/pnl').then(r => r.json());
    pnl = p;
    const pv = p.totalPnl || 0;
    document.getElementById('port-pnl').textContent = (pv >= 0 ? '+$' : '-$') + Math.abs(pv).toFixed(2);
    document.getElementById('port-pnl').className = 'stat-value ' + (pv >= 0 ? 'green' : 'red');
    document.getElementById('port-roi').textContent = `ROI: ${p.roi >= 0 ? '+' : ''}${p.roi}%`;
    document.getElementById('port-totalbet').textContent = `$${p.totalBet?.toFixed(2) || '0.00'}`;
    document.getElementById('port-wr').textContent = p.successRate ? `${p.successRate}%` : '‚Äî';
    document.getElementById('port-wl').textContent = `${p.wins}W / ${p.losses}L`;
  } catch {}

  // Open orders
  try {
    const o = await fetch('/api/orders').then(r => r.json());
    orders = o.orders || [];
    document.getElementById('port-orders').textContent = orders.length;
    const body = document.getElementById('ordersBody');
    if (!orders.length) {
      body.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:30px;color:var(--muted)">No open orders. Waiting for edge opportunities.</td></tr>';
    } else {
      body.innerHTML = orders.map(o => `
        <tr>
          <td style="max-width:300px;font-size:0.83rem">${o.asset_id || o.market || '‚Äî'}</td>
          <td><span class="price-pill ${o.side==='BUY'?'pill-high':'pill-low'}">${o.side||'‚Äî'}</span></td>
          <td>${o.price ? (parseFloat(o.price)*100).toFixed(0)+'%' : '‚Äî'}</td>
          <td>$${parseFloat(o.original_size||o.size||0).toFixed(2)}</td>
          <td><span class="price-pill pill-accent">${o.status||'OPEN'}</span></td>
          <td style="color:var(--muted);font-size:0.78rem">${o.created_at ? new Date(o.created_at*1000).toLocaleDateString() : '‚Äî'}</td>
        </tr>`).join('');
    }
  } catch (err) {
    document.getElementById('ordersBody').innerHTML = `<tr><td colspan="6" style="text-align:center;padding:20px;color:var(--muted)">Could not load orders: ${err.message}</td></tr>`;
  }
}

// ‚îÄ‚îÄ History ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadHistory() {
  try {
    const d = await fetch('/api/trades').then(r => r.json());
    trades = d.trades || [];
    const body = document.getElementById('historyBody');
    if (!trades.length) {
      body.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:30px;color:var(--muted)">No trades yet.</td></tr>';
    } else {
      body.innerHTML = trades.slice(0,100).map(t => {
        const pnl = t.pnl ?? null;
        return `<tr>
          <td style="color:var(--muted);font-size:0.78rem">${t.created_at ? new Date(t.created_at*1000).toLocaleString() : '‚Äî'}</td>
          <td style="max-width:260px;font-size:0.82rem">${t.market_id || t.asset_id || '‚Äî'}</td>
          <td><span class="price-pill ${t.side==='BUY'?'pill-high':'pill-low'}">${t.side||'‚Äî'}</span></td>
          <td>${t.price ? (parseFloat(t.price)*100).toFixed(1)+'%' : '‚Äî'}</td>
          <td>$${parseFloat(t.size||t.matched_amount||0).toFixed(2)}</td>
          <td><span class="price-pill pill-accent">${t.status||'‚Äî'}</span></td>
          <td style="color:${pnl===null?'var(--muted)':pnl>=0?'var(--green)':'var(--red)'}">${pnl===null ? '‚Äî' : (pnl>=0?'+':'')+pnl.toFixed(2)}</td>
        </tr>`;}).join('');
    }
  } catch (err) {
    document.getElementById('historyBody').innerHTML = `<tr><td colspan="7" class="loading-box" style="color:var(--red)">Error: ${err.message}</td></tr>`;
  }
}

// ‚îÄ‚îÄ Wallets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadWallets() {
  try {
    const b = await fetch('/api/balances').then(r => r.json());
    balances = b;
    const grid = document.getElementById('walletGrid');
    const wallets = [
      { label: 'Holding Wallet (Cold Storage)', address: b.holding?.address, usdc: b.holding?.usdc, matic: b.holding?.matic, note: 'Primary fund storage. Cosmi sends funds here.' },
      { label: 'Polymarket Trading Wallet', address: b.polymarket?.address, usdc: b.polymarket?.usdc, matic: b.polymarket?.matic, note: 'Must have USDC.e on Polygon to trade.' },
    ];
    grid.innerHTML = wallets.map(w => `
      <div class="wallet-card">
        <div class="wc-label">${w.label}</div>
        <div class="wc-address">${w.address || '‚Äî'}</div>
        <div class="wc-balances">
          <div class="wc-bal">
            <div class="wc-bal-amount" style="color:var(--green)">$${w.usdc != null ? w.usdc.toFixed(2) : '‚Äî'}</div>
            <div class="wc-bal-label">USDC.e</div>
          </div>
          <div class="wc-bal">
            <div class="wc-bal-amount" style="color:var(--purple)">${w.matic != null ? w.matic.toFixed(4) : '‚Äî'}</div>
            <div class="wc-bal-label">MATIC (gas)</div>
          </div>
        </div>
        <div class="wc-status" style="color:var(--muted);margin-top:12px;font-size:0.75rem">‚ÑπÔ∏è ${w.note}</div>
      </div>`).join('');
  } catch (err) {
    document.getElementById('walletGrid').innerHTML = `<div class="loading-box" style="color:var(--red)">Error loading balances: ${err.message}</div>`;
  }
}

// ‚îÄ‚îÄ Refresh all ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function refreshAll() {
  _marketsCache = null;
  markets = [];
  await loadStatus();
  const activePage = document.querySelector('.nav-item.active')?.dataset.page || 'overview';
  if (activePage === 'overview') await loadOverview();
  else loadPage(activePage);
  document.getElementById('lastUpdated').textContent = `Updated ${ts()}`;
}

let _marketsCache = null; // clear on refresh

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(async () => {
  await loadStatus();
  await loadMarkets();
  await loadOverview();
  // Auto-refresh every 60s
  setInterval(async () => {
    markets = [];
    await loadMarkets();
    const active = document.querySelector('.nav-item.active')?.dataset.page || 'overview';
    if (active === 'overview') loadOverview();
  }, 60000);
})();
</script>
</body>
</html>
